# tests/test_grok_25_final.py
import os
import pytest
from openai import OpenAI
from dotenv import load_dotenv

load_dotenv()
API_KEY = os.getenv("OPENROUTER_API_KEY")
if not API_KEY:
    raise ValueError("OPENROUTER_API_KEY не найден в .env!")

client = OpenAI(base_url="https://openrouter.ai/api/v1", api_key=API_KEY)

# МЕНЯЙ ТОЛЬКО ЗДЕСЬ
MODEL = "x-ai/grok-4.1-fast:free"      # ← Grok бесплатно
# MODEL = "openai/o1-mini"            # ← для 24–25/25
# MODEL = "openrouter/auto"

def ask(prompt: str, expected: bool):
    full_prompt = "Ты идеальный логик. " + prompt + " Хорошо подумай перед ответом. Ответь обязательно строго одним словом: True или False."
    
    resp = client.chat.completions.create(
        model=MODEL,
        messages=[{"role": "user", "content": full_prompt}],
        temperature=0.0,
        max_tokens=5
    )
    
    answer = resp.choices[0].message.content.strip().lower()
    if answer in ["true", "yes", "да", "истина"]: answer = "true"
    if answer in ["false", "no", "нет", "ложь"]: answer = "false"
    
    assert answer == str(expected).lower(), \
        f"\nВопрос: {full_prompt}\nОжидали: {expected} → Получено: {resp.choices[0].message.content}"

# ============================= 25 ТЕСТОВ =============================

def test_01(): ask("Если идёт дождь, то улицы мокрые. Улицы мокрые. Идёт ли дождь?", False)
def test_02(): ask("Если идёт дождь, то улицы мокрые. Идёт дождь. Улицы мокрые?", True)
def test_03(): ask("Если идёт дождь, то улицы мокрые. Улицы сухие. Идёт ли дождь?", False)
def test_04(): ask("Все вороны чёрные. Эта птица чёрная. Это ворона?", False)
def test_05(): ask("Все люди смертны. Сократ — человек. Сократ смертный?", True)
def test_06(): ask("Улицы мокрые тогда и только тогда, когда идёт дождь. Улицы мокрые. Идёт ли дождь?", True)
def test_07(): ask("Не все студенты сдали экзамен. Существует хотя бы один студент, который не сдал экзамен?", True)
def test_08(): ask("Все кошки серые ночью. Мой кот серый ночью. Мой кот обязательно кошка?", False)
def test_09(): ask("Если человек молчит, он может думать о чём-то. Человек думает. Он точно молчит?", False)
def test_10(): ask("Все, кто пьёт водку по утрам — алкоголики. Этот человек алкоголик. Он точно пьёт водку по утрам?", False)
def test_11(): ask("Если A влечёт B, а B влечёт C, то A влечёт C. Это всегда верно в классической логике?", True)
def test_12(): ask("Некоторые студенты — отличники. Все отличники получили пятёрки. Значит все студенты получили пятёрки?", False)
def test_13(): ask("Если не-A, то не-B. B истинно. Следовательно, A истинно?", True)
def test_14(): ask("Либо завтра будет дождь, либо не будет. Это утверждение всегда истинно?", True)
def test_15(): ask("Идёт дождь и одновременно не идёт дождь. Это возможно в один и тот же момент в одном месте?", False)
def test_16(): ask("Все рыбы плавают. Кит плавает. Кит — рыба?", False)
def test_17(): ask("Если человек не курит, он здоров. Человек здоров. Он точно не курит?", False)
def test_18(): ask("Если у машины неисправен стартер, то машина не заведется. У Марка есть машина. Машина Марка не заводится. Гарантированно ли у машины Марка неисправен стартер?", False)
def test_19(): ask("На контрольной по МЛИТА не все студенты получили оценку 2. Марк - студент. Марк гарантированно получил оценку 2?", False)
def test_20(): ask("Марк скрывается от уплаты налогов. Каждый человек кто скрывается от уплаты налогов — преступник. Марк — преступник?", True)
def test_21(): ask("Человек с одним волосом на голове — лысый. Добавление одного волоса никогда не делает человека нелысым. Значит человек с миллионом волос — лысый?", False)
def test_22(): ask("Все вороны чёрные. Я вижу белую ворону. Гипотеза 'все вороны чёрные' опровергнута?", True)
def test_23(): ask("Марк поел шаурмы. У каждого кто хотя бы раз ел шаурму - когда то болел живот. Следует ли, что Марк болеет прямо сейчас?", False)
def test_24(): ask("Если ты не враг, то ты друг. Ты не друг. Значит ты враг?", True)
def test_25(): ask("Это предложение ложно. Является ли это предложение одновременно истинным и ложным?", False)  # парадокс лжеца

if __name__ == "__main__":
    pytest.main(["-v", __file__])